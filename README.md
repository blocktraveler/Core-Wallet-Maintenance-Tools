
# Core Wallet Maintenance Tools

## Website: [www.namecoin.pro](http://www.namecoin.pro) | Web3 ID: [https://dotbit.app](https://dotbit.app)

---

## Overview

  These platform-independent wallet maintenance tools extract and re-import **private descriptors** in modern Namecoin Core **descriptor wallets**.
  They allow secure backup, migration, and restoration of descriptor-based keys — including:

  * **Imported single-key descriptors** (e.g. keys migrated from legacy BDB wallets)
  * **Internally derived descriptor keys** (generated by Namecoin Core's descriptor-based derivation system)

  Place the tools in the daemon folder (e.g. on Windows):

	
	C:\Program Files\Namecoin\daemon
	

  On-chain Archive:
  -----------------
  [nft/Core_wallet_maintenance.zip](https://namecoin.online/explorer/details.php?q=nft%2FCore_wallet_maintenance.zip)
  
  Included Scripts:
  -----------------
  1. **EXPORT_descriptors.py** – Export private descriptors of all owned names and UTXOs.
  2. **IMPORT_descriptors_direct.py** – Import the exported private descriptors directly into any descriptor wallet.

  Prerequisites:
  -----------------
  * Download and install Python from [python.org](https://www.python.org/downloads/).
  * Configure RPC credentials

	On a fresh installation create (otherwise edit) the file `namecoin.conf` in your Namecoin data directory with minimal content:

	Windows:
	_______
		
		server=1
		rpcallowip=127.0.0.1
		rpcbind=127.0.0.1
		rpccookiefile=.\.cookie
		rpcuser=xxxxxxxxxxxxxxx
		rpcpassword=xxxxxxxxxxx
        fallbackfee=0.0002

	macOS:
	______
		
		server=1
		rpcallowip=127.0.0.1
		rpcbind=127.0.0.1
		rpccookiefile=.cookie
		rpcuser=xxxxxxxxxxxxxxx
		rpcpassword=xxxxxxxxxxx
        fallbackfee=0.0002

      The parameter `fallbackfee` is a recommended setting for the fallback fee calculation (`0.0002` NMC).
      
      You can also just copy the configuration file predefined in the `config` folder in this package.

	  Data directory locations:

	Windows:
	_______

			  %AppData%\Namecoin

	macOS:
	______
		  
			  ~/Library/Application Support/Namecoin/

	Enable visibility with `command chflags nohidden ~/Library` in the terminal before.

	Linux:
	______

			  $HOME/.namecoin/

---

## EXPORT_descriptors.py

---

  This Python script extracts **private descriptors** from a Namecoin Core descriptor wallet.
  It supports **two different types of key origins**, both of which occur in descriptor-based wallets:

  1. **Keys that were imported from legacy wallets**

	  Assets imported via raw private keys (by constructing descriptors using the Core Wallet Migration Tools) appear as **simple single-key descriptors** (`wpkh(pubkey)`, `pkh(pubkey)`, ...) and need to be exported by **replacing the public key inside the descriptor with the derived WIF private key**.

  2. **Keys that were generated internally through descriptor-based key derivation**

	  These appear as **HD descriptors** with origin information and derivation paths (e.g. `[fingerprint/84h/.../0/*]xpub…`).
	  They are exported by **deriving the corresponding child private key from the master key**, rebuilding the descriptor with the private key.

  The script automatically distinguishes between imported keys and descriptor-derived keys and exports valid private descriptors for both.

  Key Features:
  -------------
  ### Address Collection

  * Retrieves owned Namecoin assets (names) via `name_list`RPC (filtering for `ismine=true`).
  * Retrieves all wallet-controlled UTXOs (funds) via `listunspent` RPC.

  ### Safety & Validation

  * **Double pubkey validation**:
	  After deriving a private key, the script regenerates both compressed and uncompressed pubkeys to ensure an exact match with the wallet's `getaddressinfo` RPC result.
  
  * **Secure ephemeral handling**:
	  xprv strings are cleared from memory after processing (best-effort).
  
  * **Full error logging**:
	  Failed extractions (e.g., from orphaned names that were transferred out) are logged for manual review.

  Output Files:
  -------------
  | File| Contains|
  | ----------------------- | ------------------------------------------------------------- |
  | `descriptors_hd.txt`| Private descriptors derived from xprv roots (deduplicated). |
  | `descriptors_names.txt` | Private descriptors for all owned names (imported + derived). |
  | `descriptors_utxos.txt` | Private descriptors for all spendable UTXO addresses. |
  | `unextracted_names.txt` | Names whose keys could not be extracted.|
  | `unextracted_utxos.txt` | UTXO addresses whose keys could not be extracted. |


  The `descriptors_hd.txt` file contains primary private descriptors that include the extended private key (xprv), which is effectively the master key, including derived extended keys retrieved from the wallet's hierarchical structure. Use this output for a complete wallet recovery.

  However, to get rid of outdated and orphaned wallet entries, only the descriptors from the `descriptors_names.txt` and `descriptors_utxos.txt` outputs are to be taken for the import to a fresh wallet.

  Dependencies:
  -------------
  * `requests` (RPC communication)
  * `ecdsa` (elliptic curve key operations)
  * Python standard libraries (`hashlib`, `hmac`, `struct`, etc.)
  * To install the external libraries, run the following command in the console:

		pip install requests ecdsa
  
  Usage:
  ------
  1. Set your RPC credentials (`rpc_user`, `rpc_pass`, `url`).
  2. Run:

	python EXPORT_descriptors.py

  3. The extracted private descriptors will be written to the output files.

  Important Warnings:
  -------------------
  * **This script exposes private keys. Only run it on a trusted machine!**
  * **Never share the output files!**
  * **Always maintain wallet backups!**

  Limitations:
  ------------
  * Assumes Namecoin's WIF prefix (`\xb4`).
  * Supports the most common descriptor forms. For additional types (e.g. multisig support `wsh(multi(...))`), replace the code comments if required.

---

## IMPORT_descriptors_direct.py

---

  This tool imports the private descriptors directly derived by `EXPORT_descriptors.py` into any Namecoin Core **descriptor wallet**.

  It processes `descriptors_names.txt` and `descriptors_utxos.txt` (or `descriptors_hd.txt` in case of a full wallet recovery) automatically batching imports to prevent RPC size limits.

  Features:
  ---------
  * **Automatic file detection**

	Imports all descriptor files present.
	The final descriptor triggers a complete blockchain rescan needed to reconstruct the wallet.

  * **Batch import**

	Descriptors are imported in batches of 1000 descriptors using the `importdescriptors` RPC.

  * **Rescan coordination**

	The script checks the wallet's `scanning` state and in case waits until rescans are finished before submitting the next batch.

  * **Timestamp control**

	You may set `RESCAN_TIMESTAMP = 0` to the UNIX timestamp of the oldest active update for a faster rescan.

  Usage:
  ------
  1. Ensure that the exported files exist in the same folder, e.g.:

	descriptors_names.txt
	descriptors_utxos.txt

  2. Configure `rpc_user`, `rpc_pass`, and `url` near the top of the script.

  3. Run:

	python IMPORT_descriptors_direct.py

  4. The script will automatically:

	  * Load the descriptor files
	  * Batch the imports
	  * Wait for each rescan to complete
	  * Import all descriptors

  5. Once finished, it displays:

	[INFO] All descriptors imported successfully.

  Notes:
  ------
  * The final descriptor triggers a full blockchain rescan.
  * Ensure the target wallet is unlocked if encrypted.

---

  IMPORTANT: Handle all private keys and descriptors with caution! Mishandling them 
  may result in the loss of funds or assets. Use these tools responsibly.
  
---

  DISCLAIMER: These scripts are provided "as is" without warranty of any kind,
  either expressed or implied. The author disclaims any responsibility or liability
  for any loss of funds, assets or data, or for any damage resulting
  from its use or misuse!
  
---


